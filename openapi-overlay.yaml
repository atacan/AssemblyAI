# OpenAPI Overlay for Assemblyai
# This file allows you to make manual corrections to the OpenAPI specification
# without modifying the original file. The bootstrapper will apply this overlay
# on top of the cleaned openapi.yaml file.
#
# For overlay syntax, see: https://github.com/OAI/Overlay-Specification

overlay: 1.0.0
info:
  title: Assemblyai API Overlay
  version: 1.0.0

# Example actions (uncomment and modify as needed):
# actions:
#   # Make a field required
#   - target: "$.components.schemas.User"
#     update:
#       required:
#         - user_id
#         - email
#
#   # Add a missing property
#   - target: "$.components.schemas.Product"
#     update:
#       properties:
#         newField:
#           type: string
#           description: "A field that was missing in the original spec"
#
#   # Fix an incorrect type
#   - target: "$.components.schemas.Order.properties.total"
#     update:
#       type: number
#       format: double
#
#   # Remove a deprecated field
#   - target: "$.components.schemas.LegacyModel.properties.oldField"
#     remove: true

actions:
  # Remove existing Transcript required field
  - target: "$.components.schemas.Transcript.required"
    remove: true

  # Update Transcript schema required fields and additionalProperties
  - target: "$.components.schemas.Transcript"
    update:
      required:
        - audio_url
        - auto_highlights
        - id
        - redact_pii
        - status
        - summarization
        - webhook_auth
      additionalProperties: true

  # Remove existing ContentSafetyLabelsResult required field
  - target: "$.components.schemas.ContentSafetyLabelsResult.required"
    remove: true

  # Update ContentSafetyLabelsResult schema required fields
  - target: "$.components.schemas.ContentSafetyLabelsResult"
    update:
      required:
        - status
        - results
        - summary
        - severity_score_summary

  # Remove required from TopicDetectionModelResult schema
  - target: "$.components.schemas.TopicDetectionModelResult.required"
    remove: true

  # Remove existing TranscriptWord required field
  - target: "$.components.schemas.TranscriptWord.required"
    remove: true

  # Update TranscriptWord schema required fields
  - target: "$.components.schemas.TranscriptWord"
    update:
      required:
        - confidence
        - start
        - end
        - text

  # Remove existing TranscriptSentence required field
  - target: "$.components.schemas.TranscriptSentence.required"
    remove: true

  # Update TranscriptSentence schema required fields
  - target: "$.components.schemas.TranscriptSentence"
    update:
      required:
        - text
        - start
        - end
        - confidence
        - words

  # Add text/html content type to subtitle endpoint response
  - target: "$.paths./v2/transcript/{transcript_id}/{subtitle_format}.get.responses.200.content"
    update:
      text/html:
        schema:
          type: string

  # Add UnprocessableContent response definition to components
  - target: "$.components.responses"
    update:
      UnprocessableContent:
        description: Bad request
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/Error"

  # Add 422 response to all operations in all paths
  - target: "$.paths.*.*.responses"
    update:
      '422':
        $ref: '#/components/responses/UnprocessableContent'

  # Add text/plain content type to all response definitions
  - target: "$.components.responses.*.content"
    update:
      text/plain:
        schema:
          type: string

  # Fix expected_languages in TranscriptOptionalParams - remove incorrect 'objects' field
  - target: "$.components.schemas.TranscriptOptionalParams.properties.language_detection_options.properties.expected_languages.objects"
    remove: true

  # Fix expected_languages in TranscriptOptionalParams - add correct 'items' field
  - target: "$.components.schemas.TranscriptOptionalParams.properties.language_detection_options.properties.expected_languages"
    update:
      items:
        type: string

  # Fix expected_languages in Transcript - remove incorrect 'objects' field
  - target: "$.components.schemas.Transcript.properties.language_detection_options.properties.expected_languages.objects"
    remove: true

  # Fix expected_languages in Transcript - add correct 'items' field
  - target: "$.components.schemas.Transcript.properties.language_detection_options.properties.expected_languages"
    update:
      items:
        type: string

  # Remove existing ContentSafetyLabelsResult required field, because it comes as `{}`
  - target: "$.components.schemas.ContentSafetyLabelsResult.required"
    remove: true
